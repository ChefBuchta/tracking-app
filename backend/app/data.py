foods = [
    {
        "id": "1",
        "name": "Apple",
        "calories": 95,
        "protein": 0.5,
        "fat": 0.3,
        "carbs": 25.0,
        "fiber": 4.4,
        "sugar": 19.0,
        "sodium": 1.0,
        "vitamin_a": 3.0,
        "vitamin_c": 8.4,
        "vitamin_d": 0.0,
        "vitamin_e": 0.2,
        "vitamin_k": 2.2,
        "vitamin_b1": 0.0,
        "vitamin_b2": 0.0,
        "vitamin_b3": 0.1,
        "vitamin_b6": 0.1,
        "vitamin_b12": 0.0,
        "folate": 3.0,
        "calcium": 6.0,
        "iron": 0.1,
        "magnesium": 5.0,
        "phosphorus": 11.0,
        "potassium": 195.0,
        "zinc": 0.0
    },
    {
        "id": "2",
        "name": "Banana",
        "calories": 105,
        "protein": 1.3,
        "fat": 0.4,
        "carbs": 27.0,
        "fiber": 3.1,
        "sugar": 14.0,
        "sodium": 1.0,
        "vitamin_a": 3.0,
        "vitamin_c": 10.3,
        "vitamin_d": 0.0,
        "vitamin_e": 0.1,
        "vitamin_k": 0.5,
        "vitamin_b1": 0.0,
        "vitamin_b2": 0.1,
        "vitamin_b3": 0.8,
        "vitamin_b6": 0.4,
        "vitamin_b12": 0.0,
        "folate": 20.0,
        "calcium": 5.0,
        "iron": 0.3,
        "magnesium": 27.0,
        "phosphorus": 22.0,
        "potassium": 422.0,
        "zinc": 0.2
    },
    {
        "id": "3",
        "name": "Chicken Breast",
        "calories": 231,
        "protein": 43.5,
        "fat": 5.0,
        "carbs": 0.0,
        "fiber": 0.0,
        "sugar": 0.0,
        "sodium": 74.0,
        "vitamin_a": 6.0,
        "vitamin_c": 0.0,
        "vitamin_d": 5.0,
        "vitamin_e": 0.2,
        "vitamin_k": 0.0,
        "vitamin_b1": 0.1,
        "vitamin_b2": 0.1,
        "vitamin_b3": 15.4,
        "vitamin_b6": 1.0,
        "vitamin_b12": 0.3,
        "folate": 3.0,
        "calcium": 15.0,
        "iron": 1.0,
        "magnesium": 29.0,
        "phosphorus": 256.0,
        "potassium": 256.0,
        "zinc": 1.0
    },
    {
        "id": "4",
        "name": "Rice (White, Cooked)",
        "calories": 130,
        "protein": 2.4,
        "fat": 0.3,
        "carbs": 28.0,
        "fiber": 0.4,
        "sugar": 0.1,
        "sodium": 1.0,
        "vitamin_a": 0.0,
        "vitamin_c": 0.0,
        "vitamin_d": 0.0,
        "vitamin_e": 0.1,
        "vitamin_k": 0.0,
        "vitamin_b1": 0.0,
        "vitamin_b2": 0.0,
        "vitamin_b3": 1.6,
        "vitamin_b6": 0.1,
        "vitamin_b12": 0.0,
        "folate": 3.0,
        "calcium": 10.0,
        "iron": 1.2,
        "magnesium": 12.0,
        "phosphorus": 43.0,
        "potassium": 35.0,
        "zinc": 0.4
    },
    {
        "id": "5",
        "name": "Broccoli (Steamed)",
        "calories": 55,
        "protein": 3.7,
        "fat": 0.6,
        "carbs": 11.2,
        "fiber": 5.2,
        "sugar": 2.2,
        "sodium": 64.0,
        "vitamin_a": 623.0,
        "vitamin_c": 89.2,
        "vitamin_d": 0.0,
        "vitamin_e": 0.8,
        "vitamin_k": 101.6,
        "vitamin_b1": 0.1,
        "vitamin_b2": 0.1,
        "vitamin_b3": 0.6,
        "vitamin_b6": 0.2,
        "vitamin_b12": 0.0,
        "folate": 63.0,
        "calcium": 47.0,
        "iron": 0.7,
        "magnesium": 21.0,
        "phosphorus": 66.0,
        "potassium": 316.0,
        "zinc": 0.4
    },
    {
        "id": "6",
        "name": "Almonds",
        "calories": 579,
        "protein": 21.2,
        "fat": 49.9,
        "carbs": 21.6,
        "fiber": 12.5,
        "sugar": 4.4,
        "sodium": 1.0,
        "vitamin_a": 0.0,
        "vitamin_c": 0.0,
        "vitamin_d": 0.0,
        "vitamin_e": 25.6,
        "vitamin_k": 0.0,
        "vitamin_b1": 0.2,
        "vitamin_b2": 1.1,
        "vitamin_b3": 3.6,
        "vitamin_b6": 0.1,
        "vitamin_b12": 0.0,
        "folate": 44.0,
        "calcium": 269.0,
        "iron": 3.7,
        "magnesium": 270.0,
        "phosphorus": 481.0,
        "potassium": 733.0,
        "zinc": 3.1
    },
    {
        "id": "7",
        "name": "Egg (Boiled)",
        "calories": 68,
        "protein": 5.5,
        "fat": 4.8,
        "carbs": 0.6,
        "fiber": 0.0,
        "sugar": 0.4,
        "sodium": 124.0,
        "vitamin_a": 160.0,
        "vitamin_c": 0.0,
        "vitamin_d": 87.0,
        "vitamin_e": 0.5,
        "vitamin_k": 0.1,
        "vitamin_b1": 0.0,
        "vitamin_b2": 0.2,
        "vitamin_b3": 0.1,
        "vitamin_b6": 0.1,
        "vitamin_b12": 0.6,
        "folate": 22.0,
        "calcium": 25.0,
        "iron": 0.6,
        "magnesium": 5.0,
        "phosphorus": 86.0,
        "potassium": 63.0,
        "zinc": 0.5
    },
    {
        "id": "8",
        "name": "Salmon (Grilled)",
        "calories": 208,
        "protein": 20.0,
        "fat": 13.0,
        "carbs": 0.0,
        "fiber": 0.0,
        "sugar": 0.0,
        "sodium": 59.0,
        "vitamin_a": 149.0,
        "vitamin_c": 0.0,
        "vitamin_d": 526.0,
        "vitamin_e": 3.6,
        "vitamin_k": 0.1,
        "vitamin_b1": 0.2,
        "vitamin_b2": 0.4,
        "vitamin_b3": 8.5,
        "vitamin_b6": 0.9,
        "vitamin_b12": 2.6,
        "folate": 25.0,
        "calcium": 9.0,
        "iron": 0.3,
        "magnesium": 27.0,
        "phosphorus": 240.0,
        "potassium": 363.0,
        "zinc": 0.4
    },
    {
        "id": "9",
        "name": "Oats (Dry)",
        "calories": 389,
        "protein": 16.9,
        "fat": 6.9,
        "carbs": 66.3,
        "fiber": 10.6,
        "sugar": 0.0,
        "sodium": 2.0,
        "vitamin_a": 0.0,
        "vitamin_c": 0.0,
        "vitamin_d": 0.0,
        "vitamin_e": 0.7,
        "vitamin_k": 2.0,
        "vitamin_b1": 0.5,
        "vitamin_b2": 0.2,
        "vitamin_b3": 1.1,
        "vitamin_b6": 0.1,
        "vitamin_b12": 0.0,
        "folate": 32.0,
        "calcium": 54.0,
        "iron": 4.7,
        "magnesium": 177.0,
        "phosphorus": 523.0,
        "potassium": 429.0,
        "zinc": 4.0
    },
    {
        "id": "10",
        "name": "Milk (Whole)",
        "calories": 61,
        "protein": 3.2,
        "fat": 3.3,
        "carbs": 4.8,
        "fiber": 0.0,
        "sugar": 4.8,
        "sodium": 43.0,
        "vitamin_a": 46.0,
        "vitamin_c": 0.0,
        "vitamin_d": 1.2,
        "vitamin_e": 0.1,
        "vitamin_k": 0.2,
        "vitamin_b1": 0.0,
        "vitamin_b2": 0.1,
        "vitamin_b3": 0.1,
        "vitamin_b6": 0.0,
        "vitamin_b12": 0.4,
        "folate": 5.0,
        "calcium": 113.0,
        "iron": 0.0,
        "magnesium": 10.0,
        "phosphorus": 84.0,
        "potassium": 143.0,
        "zinc": 0.4
    }
]

# In-memory storage for diary entries
diary_entries = []

# Counter for generating unique IDs
entry_id_counter = 1

def get_food_by_id(food_id: str):
    """Get a food item by its ID"""
    return next((food for food in foods if food["id"] == food_id), None)

def add_diary_entry(food_id: str, meal_type: str, quantity: float, date: str = None):
    """Add a new diary entry"""
    global entry_id_counter
    
    food = get_food_by_id(food_id)
    if not food:
        return None
    
    from datetime import datetime
    
    if date is None:
        date = datetime.now().strftime("%Y-%m-%d")
    
    entry = {
        "id": str(entry_id_counter),
        "food_id": food_id,
        "food_name": food["name"],
        "meal_type": meal_type,
        "quantity": quantity,
        "date": date,
        "created_at": datetime.now().isoformat(),
        # Calculate nutrition based on quantity
        "calories": round(food["calories"] * quantity, 1),
        "protein": round(food["protein"] * quantity, 1),
        "fat": round(food["fat"] * quantity, 1),
        "carbs": round(food["carbs"] * quantity, 1),
        "fiber": round(food.get("fiber", 0) * quantity, 1),
        "sugar": round(food.get("sugar", 0) * quantity, 1),
        "sodium": round(food.get("sodium", 0) * quantity, 1),
    }
    
    diary_entries.append(entry)
    entry_id_counter += 1
    return entry

def get_diary_entries(date: str = None):
    """Get diary entries for a specific date"""
    if date is None:
        from datetime import datetime
        date = datetime.now().strftime("%Y-%m-%d")
    
    return [entry for entry in diary_entries if entry["date"] == date]

def delete_diary_entry(entry_id: str):
    """Delete a diary entry by ID"""
    global diary_entries
    diary_entries = [entry for entry in diary_entries if entry["id"] != entry_id]

def calculate_daily_summary(date: str = None):
    """Calculate daily nutrition summary"""
    entries = get_diary_entries(date)
    
    if not entries:
        return {
            "date": date,
            "total_entries": 0,
            "calories": 0,
            "protein": 0,
            "fat": 0,
            "carbs": 0,
            "fiber": 0,
            "sugar": 0,
            "sodium": 0
        }
    
    summary = {
        "date": date,
        "total_entries": len(entries),
        "calories": sum(entry["calories"] for entry in entries),
        "protein": sum(entry["protein"] for entry in entries),
        "fat": sum(entry["fat"] for entry in entries),
        "carbs": sum(entry["carbs"] for entry in entries),
        "fiber": sum(entry["fiber"] for entry in entries),
        "sugar": sum(entry["sugar"] for entry in entries),
        "sodium": sum(entry["sodium"] for entry in entries),
    }
    
    # Round all values
    for key in summary:
        if isinstance(summary[key], float):
            summary[key] = round(summary[key], 1)
    
    return summary
